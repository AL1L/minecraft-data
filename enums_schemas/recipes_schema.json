{
  "$schema": "http://json-schema.org/draft-04/schema#",
  "title": "recipes",

  "definitions": {
    "id": {"type":["integer","null"]},
    "metadata": {"type":"integer"},
    "amount": {"type":"integer"},
    "item":{
      "oneOf":[
        {"$ref" : "#/definitions/id"},
        {
          "type":"array",
          "items":[
            {"$ref" : "#/definitions/id"},
            {"$ref" : "#/definitions/metadata"}
          ],
          "additionalItems": false
        },
        {
          "type":"object",
          "properties":{
            "id":{"$ref" : "#/definitions/id"},
            "meta":{"$ref" : "#/definitions/metadata"},
            "amount":{"$ref" : "#/definitions/amount"}
          },
          "required": ["id"],
          "additionalProperties":false
        }
      ]
    },
    "shape": {
      "type": "array",
      "minItems": 1,
      "maxItems": 3,
      "items": {
        "type": "array",
        "minItems": 1,
        "maxItems": 3,
        "items": {"$ref" : "#/definitions/item"}
      }
    },
    "ingredients": {
      "type": "array",
      "minItems": 1,
      "items": {"$ref" : "#/definitions/item"}
    },
    "shaped_recipe": {
      "type": "object",
      "properties": {
        "result":{"$ref" : "#/definitions/item"},
        "inShape":{"$ref" : "#/definitions/shape"},
        "outShape":{"$ref" : "#/definitions/shape"}
      },
      "required":["result","inShape"],
      "additionalProperties":false
    },
    "shapeless_recipe": {
      "type": "object",
      "properties": {
        "result":{"$ref" : "#/definitions/item"},
        "ingredients":{"$ref" : "#/definitions/ingredients"}
      },
      "required":["result","ingredients"],
      "additionalProperties":false
    },
    "recipe": {
      "oneOf":[
        {"$ref" : "#/definitions/shaped_recipe"},
        {"$ref" : "#/definitions/shapeless_recipe"}
      ]
    }
  },

  "type": "object",
  "uniqueItems": true,
  "patternProperties" : {
    "^[0-9]+$": {
      "type": "array",
      "uniqueItems": true,
      "items": {"$ref" : "#/definitions/recipe"}
    }
  },
  "additionalProperties": false
}